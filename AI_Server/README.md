# Spam Mail AI Server

This project provides a simple AI-powered web server to classify emails as "spam" or "ham" (not spam). It includes a script to train a Naive Bayes classifier and a Flask application to serve the model via a REST API.

## Features

- **Model Training**: A script (`create_model.py`) to train a text classification model on your own data.
- **API Server**: A Flask server (`app.py`) that exposes a `/analyze` endpoint for real-time email classification.
- **Dynamic Data Handling**: The training script automatically detects common column names for text and labels in your CSV data.
- **Dataset Balancing**: Automatically handles imbalanced datasets by downsampling the majority class or upsampling the minority class.

## Project Structure

```
AI_Server/
├── Merged1_data.csv      # Your email dataset (you must provide this)
├── better_spam_model.pkl # The trained model (generated by create_model.py)
├── create_model.py       # Script to train and save the model
├── app.py                # The Flask API server
├── requirements.txt      # Python dependencies
└── .gitignore            # Files to be ignored by Git
```

## Setup and Installation

1.  **Clone the Repository**
    Navigate to the project directory.

2.  **Create and Activate a Virtual Environment**
    It's highly recommended to use a virtual environment to manage dependencies.

    ```bash
    # For Windows
    python -m venv .venv
    .\.venv\Scripts\activate

    # For macOS/Linux
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Install Dependencies**
    Install all the required Python packages.

    ```bash
    pip install -r requirements.txt
    ```

## Usage

### 1. Prepare Your Data

Place your email dataset in the `AI_Server` directory and name it `Merged1_data.csv`. The training script will automatically look for it. The CSV should contain at least two columns: one for the email text and one for the label ('spam' or 'ham').

The script will try to auto-detect columns with names like `message`, `text`, `email` for the content and `category`, `label`, `class` for the labels.

### 2. Train the Model

Run the training script. This will process the data, train the classifier, evaluate its performance, and save the trained model to `better_spam_model.pkl`.

```bash
python create_model.py
```

### 3. Run the AI Server

Start the Flask server. It will load the `better_spam_model.pkl` file and be ready to accept requests.

```bash
python app.py
```

The server will be running at `http://127.0.0.1:5000`.

### 4. Analyze an Email

You can send a `POST` request to the `/analyze` endpoint with a JSON payload containing the email text.

**Example using `curl`:**

```bash
curl -X POST -H "Content-Type: application/json" \
-d '{"text": "Congratulations! You won a free iPhone. Click here to claim."}' \
http://127.0.0.1:5000/analyze
```

**Expected Response:**

The API will return a JSON object with the predicted category and the calculated probability of it being spam.

```json
{
  "predicted_category": "spam",
  "spam_probability": 0.987654321
}
```